<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AET | Interactive Sensitivity Model</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --aet-navy: #0A2540;
            --aet-blue: #00A3E0;
            --aet-green: #6CC24A;
            --bg-light: #F4F7F6;
            --white: #ffffff;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg-light);
            color: #333;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        aside {
            width: 320px;
            background: var(--aet-navy);
            color: white;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--aet-green);
            padding-bottom: 1rem;
        }

        /* Controls Area */
        .control-group { margin-bottom: 1.5rem; }
        
        label {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #bdc3c7;
        }

        .value-display { color: var(--aet-green); }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--aet-green);
        }

        .scenario-btns {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .s-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: 0.2s;
        }

        .s-btn:hover, .s-btn.active { background: var(--aet-green); color: var(--aet-navy); font-weight: bold; border-color: var(--aet-green); }

        /* Main Dashboard */
        main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        header {
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; color: var(--aet-navy); font-family: 'Montserrat', sans-serif; }
        .tag { background: #e0f2f1; color: #00695c; padding: 5px 15px; border-radius: 15px; font-weight: bold; font-size: 0.8rem; }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            transition: 0.3s;
            border-top: 4px solid var(--aet-navy);
        }

        .card-label { font-size: 0.8rem; text-transform: uppercase; color: #888; font-weight: bold; margin-bottom: 0.5rem; }
        .card-value { font-size: 1.8rem; font-weight: 700; color: var(--aet-navy); font-family: 'Montserrat', sans-serif; }
        .card-sub { font-size: 0.8rem; color: #666; margin-top: 5px; }

        /* Special Styling for DSCR */
        #card-dscr { transition: 0.3s; }
        #card-dscr.safe { border-top-color: var(--success); background: #ecfdf5; }
        #card-dscr.warning { border-top-color: var(--warning); background: #fffbeb; }
        #card-dscr.danger { border-top-color: var(--danger); background: #fef2f2; }

        /* Charts / Tables Area */
        .dashboard-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            height: 100%;
        }

        .panel {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        h3 { margin-top: 0; color: var(--aet-navy); border-bottom: 1px solid #eee; padding-bottom: 10px; }

        /* Simple CSS Bar Chart */
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .bar-group { display: flex; align-items: center; font-size: 0.9rem; }
        .bar-label { width: 120px; font-weight: 600; }
        .bar-track { flex: 1; background: #eee; height: 25px; border-radius: 4px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; background: var(--aet-navy); transition: width 0.5s ease; display: flex; align-items: center; padding-right: 10px; justify-content: flex-end; color: white; font-size: 0.8rem; }
        .bar-fill.revenue { background: var(--aet-blue); }
        .bar-fill.opex { background: #e74c3c; }
        .bar-fill.ebitda { background: var(--aet-green); }
        .bar-fill.debt { background: #f39c12; }

    </style>
</head>
<body>

<aside>
    <div class="logo">AET <span>Models</span></div>

    <div class="scenario-btns">
        <button class="s-btn active" onclick="setScenario('bank')">Bank Case</button>
        <button class="s-btn" onclick="setScenario('equity')">Upside Case</button>
    </div>

    <div class="control-group">
        <label>Throughput (tpa) <span class="value-display" id="val-tpa">100,000</span></label>
        <input type="range" id="in-tpa" min="50000" max="150000" step="5000" value="100000" oninput="updateModel()">
    </div>

    <div class="control-group">
        <label>Avg Gate Fee ($/t) <span class="value-display" id="val-gate">150</span></label>
        <input type="range" id="in-gate" min="100" max="250" step="5" value="150" oninput="updateModel()">
    </div>

    <div class="control-group">
        <label>Capex ($M) <span class="value-display" id="val-capex">50.0</span></label>
        <input type="range" id="in-capex" min="30" max="70" step="1" value="50" oninput="updateModel()">
    </div>

    <div class="control-group">
        <label>Debt Leverage (%) <span class="value-display" id="val-lev">60%</span></label>
        <input type="range" id="in-lev" min="30" max="80" step="5" value="60" oninput="updateModel()">
    </div>

    <div class="control-group">
        <label>Interest Rate (%) <span class="value-display" id="val-rate">6.5%</span></label>
        <input type="range" id="in-rate" min="3" max="12" step="0.5" value="6.5" oninput="updateModel()">
    </div>

    <div class="control-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
        <label>Recovery Rate (%) <span class="value-display" id="val-rec">20%</span></label>
        <input type="range" id="in-rec" min="10" max="40" step="1" value="20" oninput="updateModel()">
        <small style="color: #888; display: block; margin-top: 5px;">Avg Commodity Basket Value: $300/t</small>
    </div>

</aside>

<main>
    <header>
        <div>
            <h1>ARRC Financial Sensitivity</h1>
            <span style="color: #666; font-size: 0.9rem;">High-Level Unit Economics Calculator</span>
        </div>
        <div class="tag">INTERNAL ONLY</div>
    </header>

    <div class="kpi-grid">
        <div class="card">
            <div class="card-label">Total Revenue</div>
            <div class="card-value" id="out-revenue">$15.0M</div>
            <div class="card-sub">Per Annum</div>
        </div>
        <div class="card">
            <div class="card-label">EBITDA</div>
            <div class="card-value" id="out-ebitda">$6.5M</div>
            <div class="card-sub" id="out-margin">43% Margin</div>
        </div>
        <div class="card" id="card-dscr">
            <div class="card-label">DSCR (Bankability)</div>
            <div class="card-value" id="out-dscr">1.45x</div>
            <div class="card-sub">Target > 1.35x</div>
        </div>
        <div class="card">
            <div class="card-label">Equity IRR (Est)</div>
            <div class="card-value" id="out-irr">18.2%</div>
            <div class="card-sub">10 Year Horizon</div>
        </div>
    </div>

    <div class="dashboard-row">
        <div class="panel">
            <h3>Cashflow Waterfall</h3>
            <p style="font-size: 0.9rem; color: #666;">Visualizing the flow from Revenue down to Net Cashflow after Debt.</p>
            
            <div class="bar-chart">
                <div class="bar-group">
                    <div class="bar-label">Revenue</div>
                    <div class="bar-track">
                        <div class="bar-fill revenue" id="bar-rev" style="width: 100%;">$15.0M</div>
                    </div>
                </div>
                
                <div class="bar-group">
                    <div class="bar-label">Opex</div>
                    <div class="bar-track">
                        <div class="bar-fill opex" id="bar-opex" style="width: 60%;">$8.5M</div>
                    </div>
                </div>

                <div class="bar-group">
                    <div class="bar-label">EBITDA</div>
                    <div class="bar-track">
                        <div class="bar-fill ebitda" id="bar-ebitda" style="width: 40%;">$6.5M</div>
                    </div>
                </div>

                <div class="bar-group">
                    <div class="bar-label">Debt Service</div>
                    <div class="bar-track">
                        <div class="bar-fill debt" id="bar-debt" style="width: 25%;">$3.5M</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 15px; background: #f8fafc; border-radius: 6px; font-size: 0.9rem;">
                <strong>Bankability Check:</strong> <span id="bank-msg">The project meets lender requirements.</span>
            </div>
        </div>

        <div class="panel">
            <h3>Key Assumptions</h3>
            <ul style="list-style: none; padding: 0; font-size: 0.9rem; line-height: 2;">
                <li><strong>Opex (Fixed):</strong> $2.5M / year</li>
                <li><strong>Opex (Variable):</strong> $55 / tonne</li>
                <li><strong>Basket Value:</strong> $300 / tonne (recovered)</li>
                <li><strong>Loan Term:</strong> 15 Years</li>
                <li><strong>Tax Rate:</strong> 30%</li>
            </ul>
        </div>
    </div>

</main>

<script>
    // --- Model Logic ---
    
    function updateModel() {
        // 1. Get Inputs
        const tpa = parseInt(document.getElementById('in-tpa').value);
        const gateFee = parseInt(document.getElementById('in-gate').value);
        const capex = parseFloat(document.getElementById('in-capex').value) * 1000000;
        const leverage = parseInt(document.getElementById('in-lev').value) / 100;
        const interestRate = parseFloat(document.getElementById('in-rate').value) / 100;
        const recoveryRate = parseInt(document.getElementById('in-rec').value) / 100;
        
        // Constants (Assumptions)
        const commodityPrice = 300; // $/t avg basket
        const fixedOpex = 2500000;
        const variableOpexPerTon = 55;
        const loanTermYears = 15;

        // Update Labels
        document.getElementById('val-tpa').textContent = tpa.toLocaleString();
        document.getElementById('val-gate').textContent = gateFee;
        document.getElementById('val-capex').textContent = (capex/1000000).toFixed(1);
        document.getElementById('val-lev').textContent = (leverage*100).toFixed(0) + "%";
        document.getElementById('val-rate').textContent = (interestRate*100).toFixed(1) + "%";
        document.getElementById('val-rec').textContent = (recoveryRate*100).toFixed(0) + "%";

        // 2. Calculations
        
        // Revenue
        const revGate = tpa * gateFee;
        const revCommodities = tpa * recoveryRate * commodityPrice;
        const totalRevenue = revGate + revCommodities;

        // Opex
        const totalOpex = fixedOpex + (tpa * variableOpexPerTon);

        // EBITDA
        const ebitda = totalRevenue - totalOpex;
        const ebitdaMargin = (ebitda / totalRevenue) * 100;

        // Debt Service (PMT Calculation)
        const principal = capex * leverage;
        const monthlyRate = interestRate / 12;
        const numPayments = loanTermYears * 12;
        // PMT Formula
        const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
        const annualDebtService = monthlyPayment * 12;

        // Metrics
        const dscr = ebitda / annualDebtService;
        
        // Simplified Equity IRR Proxy (Cash on Cash Yield for simplicity in this view)
        const equityCheque = capex * (1 - leverage);
        const cashFlowAfterDebt = ebitda - annualDebtService; // Pre-tax for simplicity
        const cashYield = (cashFlowAfterDebt / equityCheque) * 100; 

        // 3. Update Outputs
        
        // Number Format Helper
        const fmtM = (num) => "$" + (num / 1000000).toFixed(1) + "M";
        
        document.getElementById('out-revenue').textContent = fmtM(totalRevenue);
        document.getElementById('out-ebitda').textContent = fmtM(ebitda);
        document.getElementById('out-margin').textContent = ebitdaMargin.toFixed(0) + "% Margin";
        document.getElementById('out-dscr').textContent = dscr.toFixed(2) + "x";
        document.getElementById('out-irr').textContent = cashYield.toFixed(1) + "% (Yield)";

        // 4. Update Charts (Widths relative to Revenue)
        const maxWidth = totalRevenue; // Base 100%
        document.getElementById('bar-rev').style.width = "100%";
        document.getElementById('bar-rev').textContent = fmtM(totalRevenue);

        document.getElementById('bar-opex').style.width = ((totalOpex / maxWidth) * 100) + "%";
        document.getElementById('bar-opex').textContent = fmtM(totalOpex);

        document.getElementById('bar-ebitda').style.width = ((ebitda / maxWidth) * 100) + "%";
        document.getElementById('bar-ebitda').textContent = fmtM(ebitda);

        document.getElementById('bar-debt').style.width = ((annualDebtService / maxWidth) * 100) + "%";
        document.getElementById('bar-debt').textContent = fmtM(annualDebtService);

        // 5. Visual Feedback (Traffic Lights)
        const dscrCard = document.getElementById('card-dscr');
        const bankMsg = document.getElementById('bank-msg');
        
        if (dscr < 1.20) {
            dscrCard.className = "card danger";
            bankMsg.innerHTML = "<strong style='color:var(--danger)'>CRITICAL:</strong> Project is unbankable. DSCR is too low.";
        } else if (dscr < 1.35) {
            dscrCard.className = "card warning";
            bankMsg.innerHTML = "<strong style='color:var(--warning)'>WARNING:</strong> DSCR is tight. Lenders will require more equity.";
        } else {
            dscrCard.className = "card safe";
            bankMsg.innerHTML = "<strong style='color:var(--success)'>BANKABLE:</strong> Strong coverage meets lender criteria.";
        }
    }

    // --- Scenarios ---

    function setScenario(type) {
        // Helper to set value and trigger event
        const setVal = (id, val) => {
            document.getElementById(id).value = val;
        };

        if (type === 'bank') {
            setVal('in-tpa', 90000);     // Conservative Volume
            setVal('in-gate', 140);      // Lower Gate Fee
            setVal('in-capex', 55);      // Cost Blowout
            setVal('in-lev', 50);        // Lower Leverage
            setVal('in-rec', 15);        // Low Recovery
            document.querySelectorAll('.s-btn')[0].classList.add('active');
            document.querySelectorAll('.s-btn')[1].classList.remove('active');
        } else {
            setVal('in-tpa', 110000);    // Upside Volume
            setVal('in-gate', 160);      // High Gate Fee
            setVal('in-capex', 50);      // Target Cost
            setVal('in-lev', 65);        // Higher Leverage
            setVal('in-rec', 25);        // High Recovery
            document.querySelectorAll('.s-btn')[0].classList.remove('active');
            document.querySelectorAll('.s-btn')[1].classList.add('active');
        }
        updateModel();
    }

    // Initialize
    updateModel();

</script>

</body>
</html>